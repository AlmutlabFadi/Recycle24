[
  {
    "projectId": "e8a7ecf3-ce87-4865-83c1-283c5f7bbdb7",
    "testId": "f7d4d943-9c1e-44ae-bd21-44c432840d38",
    "userId": "9408a4b8-a061-708b-92a3-dc868714635a",
    "title": "TC001-get_transport_offers_by_trackingid",
    "description": "Test retrieving all transport offers for a given trackingId. Verify success response with offers array, 400 for invalid trackingId format, and 404 for non-existent trackingId.",
    "code": "import requests\nimport uuid\n\nBASE_URL = \"http://127.0.0.1:3000\"\nTIMEOUT = 30\n\ndef test_get_transport_offers_by_trackingid():\n    # Helper function to create a transport offer (required to have a valid trackingId with offers)\n    def create_offer(tracking_id):\n        offer_data = {\n            \"trackingId\": tracking_id,\n            \"driverId\": f\"DRV-{uuid.uuid4().hex[:8]}\",\n            \"driverName\": \"Test Driver\",\n            \"driverPhone\": \"+966500000001\",\n            \"price\": 1000,\n            \"rating\": 4.5\n        }\n        r = requests.post(f\"{BASE_URL}/api/transport/offers\", json=offer_data, timeout=TIMEOUT)\n        r.raise_for_status()\n        resp = r.json()\n        assert resp.get(\"success\") is True, f\"Failed to create offer: {resp}\"\n        return offer_data[\"trackingId\"], offer_data[\"driverId\"]\n\n    # Use a fixed trackingId for testing consistent with PRD example\n    valid_tracking_id = \"REQ123\"\n    create_offer(valid_tracking_id)  # Create a valid offer so that GET returns results\n\n    try:\n        # 1. Success: GET /api/transport/offers?trackingId=valid_tracking_id\n        r = requests.get(f\"{BASE_URL}/api/transport/offers\", params={\"trackingId\": valid_tracking_id}, timeout=TIMEOUT)\n        assert r.status_code == 200, f\"Expected 200, got {r.status_code}\"\n        resp = r.json()\n        assert resp.get(\"success\") is True, \"Success flag not True in 200 response\"\n        assert isinstance(resp.get(\"offers\"), list), \"Offers is not a list in success response\"\n        assert len(resp[\"offers\"]) > 0, \"Offers list is empty when it should contain offers\"\n\n        # 2. Error 400: invalid trackingId format (e.g., empty or malformed)\n        invalid_tracking_ids = [\"\", \"!!!invalid###\", \"123 45\", \"req@123\"]\n        for bad_id in invalid_tracking_ids:\n            r = requests.get(f\"{BASE_URL}/api/transport/offers\", params={\"trackingId\": bad_id}, timeout=TIMEOUT)\n            assert r.status_code == 400 or r.status_code == 422, f\"Expected 400 or 422 for bad trackingId '{bad_id}', got {r.status_code}\"\n            resp = r.json()\n            assert resp.get(\"success\") is False, f\"Expected success=False for bad trackingId '{bad_id}'\"\n            assert \"error\" in resp and isinstance(resp[\"error\"], str) and resp[\"error\"], f\"Error message missing for bad trackingId '{bad_id}'\"\n\n        # 3. Error 404: non-existent trackingId\n        non_existent_id = f\"NON_EXISTENT_{uuid.uuid4().hex[:8]}\"\n        r = requests.get(f\"{BASE_URL}/api/transport/offers\", params={\"trackingId\": non_existent_id}, timeout=TIMEOUT)\n        assert r.status_code == 404, f\"Expected 404 for non-existent trackingId, got {r.status_code}\"\n        resp = r.json()\n        assert resp.get(\"success\") is False, \"Expected success=False in 404 response\"\n        assert \"error\" in resp and isinstance(resp[\"error\"], str) and resp[\"error\"], \"Error message missing in 404 response\"\n\n    finally:\n        # Cleanup: delete created offer - no DELETE endpoint specified in PRD, so skip cleanup\n        pass\n\ntest_get_transport_offers_by_trackingid()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 58, in <module>\n  File \"<string>\", line 31, in test_get_transport_offers_by_trackingid\nAssertionError: Expected 200, got 404\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-25T04:37:41.228Z",
    "modified": "2026-02-25T04:38:29.318Z"
  },
  {
    "projectId": "e8a7ecf3-ce87-4865-83c1-283c5f7bbdb7",
    "testId": "c7dd8866-b424-479e-8518-6ec17b6e0042",
    "userId": "9408a4b8-a061-708b-92a3-dc868714635a",
    "title": "TC002-post_create_transport_offer",
    "description": "Test creating a new transport offer with valid driver and price details. Verify success response, 400 for invalid input such as negative price or missing fields, and 404 if trackingId or driverId does not exist.",
    "code": "import requests\n\nBASE_URL = \"http://127.0.0.1:3000\"\nOFFERS_PATH = \"/api/transport/offers\"\nTIMEOUT = 30\n\n\ndef test_post_create_transport_offer():\n    headers = {\"Content-Type\": \"application/json\"}\n\n    # Helper function to create a valid offer\n    def create_offer(tracking_id, driver_id, driver_name, driver_phone, price, rating):\n        payload = {\n            \"trackingId\": tracking_id,\n            \"driverId\": driver_id,\n            \"driverName\": driver_name,\n            \"driverPhone\": driver_phone,\n            \"price\": price,\n            \"rating\": rating,\n        }\n        resp = requests.post(\n            BASE_URL + OFFERS_PATH, json=payload, headers=headers, timeout=TIMEOUT\n        )\n        return resp\n\n    # Assume these IDs do not exist for negative test\n    NON_EXISTENT_TRACKING_ID = \"NON_EXISTENT_TRACK123\"\n    NON_EXISTENT_DRIVER_ID = \"UNKNOWN_DRV\"\n\n    # Positive test: valid input\n    valid_tracking_id = \"REQ123\"\n    valid_driver_id = \"DRV1\"\n    valid_driver_name = \"Ali\"\n    valid_driver_phone = \"+966500000000\"\n    valid_price = 1500\n    valid_rating = 4.8\n\n    # Try creating a valid offer, then delete if needed\n    create_resp = create_offer(\n        valid_tracking_id,\n        valid_driver_id,\n        valid_driver_name,\n        valid_driver_phone,\n        valid_price,\n        valid_rating,\n    )\n    assert create_resp.status_code == 200, f\"Expected 200 but got {create_resp.status_code}\"\n    result = create_resp.json()\n    assert result.get(\"success\") == True\n    assert isinstance(result.get(\"message\"), str)\n\n    # 400 test: negative price\n    neg_price_payload = {\n        \"trackingId\": valid_tracking_id,\n        \"driverId\": valid_driver_id,\n        \"driverName\": valid_driver_name,\n        \"driverPhone\": valid_driver_phone,\n        \"price\": -10,\n        \"rating\": valid_rating,\n    }\n    resp_neg_price = requests.post(\n        BASE_URL + OFFERS_PATH, json=neg_price_payload, headers=headers, timeout=TIMEOUT\n    )\n    assert resp_neg_price.status_code == 400\n    err_neg_price = resp_neg_price.json()\n    assert err_neg_price.get(\"success\") == False\n    assert isinstance(err_neg_price.get(\"error\"), str)\n\n    # 400 test: missing fields (e.g. missing price)\n    missing_fields_payload = {\n        \"trackingId\": valid_tracking_id,\n        \"driverId\": valid_driver_id,\n        \"driverName\": valid_driver_name,\n        \"driverPhone\": valid_driver_phone,\n        # price omitted\n        \"rating\": valid_rating,\n    }\n    resp_missing = requests.post(\n        BASE_URL + OFFERS_PATH, json=missing_fields_payload, headers=headers, timeout=TIMEOUT\n    )\n    assert resp_missing.status_code == 400\n    err_missing = resp_missing.json()\n    assert err_missing.get(\"success\") == False\n    assert isinstance(err_missing.get(\"error\"), str)\n\n    # 404 test: non-existent trackingId\n    invalid_tracking_id_payload = {\n        \"trackingId\": NON_EXISTENT_TRACKING_ID,\n        \"driverId\": valid_driver_id,\n        \"driverName\": valid_driver_name,\n        \"driverPhone\": valid_driver_phone,\n        \"price\": valid_price,\n        \"rating\": valid_rating,\n    }\n    resp_404_tracking = requests.post(\n        BASE_URL + OFFERS_PATH, json=invalid_tracking_id_payload, headers=headers, timeout=TIMEOUT\n    )\n    assert resp_404_tracking.status_code == 404\n    err_404_tracking = resp_404_tracking.json()\n    assert err_404_tracking.get(\"success\") == False\n    assert isinstance(err_404_tracking.get(\"error\"), str)\n\n    # 404 test: non-existent driverId\n    invalid_driver_id_payload = {\n        \"trackingId\": valid_tracking_id,\n        \"driverId\": NON_EXISTENT_DRIVER_ID,\n        \"driverName\": valid_driver_name,\n        \"driverPhone\": valid_driver_phone,\n        \"price\": valid_price,\n        \"rating\": valid_rating,\n    }\n    resp_404_driver = requests.post(\n        BASE_URL + OFFERS_PATH, json=invalid_driver_id_payload, headers=headers, timeout=TIMEOUT\n    )\n    assert resp_404_driver.status_code == 404\n    err_404_driver = resp_404_driver.json()\n    assert err_404_driver.get(\"success\") == False\n    assert isinstance(err_404_driver.get(\"error\"), str)\n\n\ntest_post_create_transport_offer()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 121, in <module>\n  File \"<string>\", line 64, in test_post_create_transport_offer\nAssertionError\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-25T04:37:41.237Z",
    "modified": "2026-02-25T04:38:45.067Z"
  },
  {
    "projectId": "e8a7ecf3-ce87-4865-83c1-283c5f7bbdb7",
    "testId": "3f4d07dc-e97f-4243-bf50-a82cea05c756",
    "userId": "9408a4b8-a061-708b-92a3-dc868714635a",
    "title": "TC003-patch_accept_transport_offer",
    "description": "Test accepting a specific transport offer by providing trackingId and driverId. Verify success response, 400 for invalid input, and 404 if the offer or driver does not exist.",
    "code": "import requests\n\nBASE_URL = \"http://127.0.0.1:3000\"\nTIMEOUT = 30\n\ndef test_patch_accept_transport_offer():\n    offers_url = f\"{BASE_URL}/api/transport/offers\"\n    headers = {\"Content-Type\": \"application/json\"}\n\n    # Step 1: Create a valid offer to patch later\n    offer_payload = {\n        \"trackingId\": \"REQ123\",\n        \"driverId\": \"DRV1\",\n        \"driverName\": \"Ali\",\n        \"driverPhone\": \"+966500000000\",\n        \"price\": 1500,\n        \"rating\": 4.8\n    }\n\n    try:\n        resp_create = requests.post(offers_url, json=offer_payload, headers=headers, timeout=TIMEOUT)\n        assert resp_create.status_code == 200, f\"Expected 200 creating offer, got {resp_create.status_code}\"\n        json_create = resp_create.json()\n        assert json_create.get(\"success\") is True\n\n        # Step 2: PATCH accept with valid trackingId and driverId -> expect 200 success\n        patch_payload = {\n            \"trackingId\": offer_payload[\"trackingId\"],\n            \"driverId\": offer_payload[\"driverId\"]\n        }\n        resp_patch = requests.patch(offers_url, json=patch_payload, headers=headers, timeout=TIMEOUT)\n        assert resp_patch.status_code == 200, f\"Expected 200 on patch accept, got {resp_patch.status_code}\"\n        json_patch = resp_patch.json()\n        assert json_patch.get(\"success\") is True\n        assert \"message\" in json_patch and isinstance(json_patch[\"message\"], str)\n\n        # Step 3: PATCH accept with invalid input (e.g. empty trackingId, missing driverId or empty string driverId) -> expect 400\n        invalid_inputs = [\n            {\"trackingId\": \"\", \"driverId\": \"SomeDriver\"},\n            {\"trackingId\": \"SomeTracking\", \"driverId\": \"\"},\n            {\"trackingId\": \"SomeTracking\"},  # Missing driverId\n            {\"driverId\": \"SomeDriver\"}       # Missing trackingId\n        ]\n        for invalid_payload in invalid_inputs:\n            resp_invalid = requests.patch(offers_url, json=invalid_payload, headers=headers, timeout=TIMEOUT)\n            assert resp_invalid.status_code == 400, f\"Expected 400 for invalid input {invalid_payload}, got {resp_invalid.status_code}\"\n            json_invalid = resp_invalid.json()\n            assert json_invalid.get(\"success\") is False\n            assert \"error\" in json_invalid and isinstance(json_invalid[\"error\"], str)\n\n        # Step 4: PATCH accept with non-existent offer or driver -> expect 404\n        non_existent_cases = [\n            {\"trackingId\": \"NON_EXISTENT_REQ\", \"driverId\": offer_payload[\"driverId\"]},\n            {\"trackingId\": offer_payload[\"trackingId\"], \"driverId\": \"UNKNOWN_DRIVER\"},\n            {\"trackingId\": \"NON_EXISTENT_REQ\", \"driverId\": \"UNKNOWN_DRIVER\"}\n        ]\n        for case in non_existent_cases:\n            resp_404 = requests.patch(offers_url, json=case, headers=headers, timeout=TIMEOUT)\n            assert resp_404.status_code == 404, f\"Expected 404 for non-existent case {case}, got {resp_404.status_code}\"\n            json_404 = resp_404.json()\n            assert json_404.get(\"success\") is False\n            assert \"error\" in json_404 and isinstance(json_404[\"error\"], str)\n\n    finally:\n        # Cleanup - no delete endpoint available per PRD\n        pass\n\ntest_patch_accept_transport_offer()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 68, in <module>\n  File \"<string>\", line 32, in test_patch_accept_transport_offer\nAssertionError: Expected 200 on patch accept, got 404\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-25T04:37:41.242Z",
    "modified": "2026-02-25T04:38:29.944Z"
  },
  {
    "projectId": "e8a7ecf3-ce87-4865-83c1-283c5f7bbdb7",
    "testId": "7412e09b-ef49-474f-976a-a41310a91ca2",
    "userId": "9408a4b8-a061-708b-92a3-dc868714635a",
    "title": "TC004-post_submit_transport_dispatch_details",
    "description": "Test submitting dispatch details after offer acceptance with valid data including ETA, vehicle info, and notes. Verify success response, 400 for invalid date/time formats or missing required fields, and 404 if trackingId does not exist.",
    "code": "import requests\n\nBASE_URL = \"http://127.0.0.1:3000\"\nTIMEOUT = 30\n\ndef test_post_submit_transport_dispatch_details():\n    # First create a transport offer to get a valid trackingId and driverId\n    create_offer_url = f\"{BASE_URL}/api/transport/offers\"\n    offer_payload = {\n        \"trackingId\": \"REQ_TEST_001\",\n        \"driverId\": \"DRV_TEST_001\",\n        \"driverName\": \"Test Driver\",\n        \"driverPhone\": \"+966500000001\",\n        \"price\": 1000,\n        \"rating\": 4.5,\n    }\n    try:\n        # Create transport offer\n        response = requests.post(create_offer_url, json=offer_payload, timeout=TIMEOUT)\n        assert response.status_code == 200, f\"Offer creation failed with status {response.status_code}\"\n        assert response.json().get(\"success\") is True\n\n        # Accept the offer to simulate offer acceptance (required before dispatch)\n        accept_offer_url = create_offer_url\n        accept_payload = {\n            \"trackingId\": offer_payload[\"trackingId\"],\n            \"driverId\": offer_payload[\"driverId\"]\n        }\n        response = requests.patch(accept_offer_url, json=accept_payload, timeout=TIMEOUT)\n        assert response.status_code == 200, f\"Offer acceptance failed with status {response.status_code}\"\n        assert response.json().get(\"success\") is True\n\n        # Valid dispatch submission\n        dispatch_url = f\"{BASE_URL}/api/transport/dispatch\"\n        valid_payload = {\n            \"trackingId\": offer_payload[\"trackingId\"],\n            \"eta\": \"2026-02-22T15:00:00Z\",\n            \"date\": \"2026-02-22\",\n            \"timeWindow\": \"15:00-17:00\",\n            \"plateNumber\": \"ABC-123\",\n            \"vehicleColor\": \"Blue\",\n            \"vehicleType\": \"Truck\",\n            \"notes\": \"On route\"\n        }\n        response = requests.post(dispatch_url, json=valid_payload, timeout=TIMEOUT)\n        assert response.status_code == 200, f\"Valid dispatch submission failed with status {response.status_code}\"\n        body = response.json()\n        assert body.get(\"success\") is True\n        assert isinstance(body.get(\"message\"), str)\n\n        # Dispatch submission with invalid date/time format\n        invalid_date_payload = {\n            \"trackingId\": offer_payload[\"trackingId\"],\n            \"eta\": \"invalid-date\",\n            \"date\": \"2026-02-22\",\n            \"timeWindow\": \"15:00-17:00\",\n            \"plateNumber\": \"ABC-123\",\n            \"vehicleColor\": \"Blue\",\n            \"vehicleType\": \"Truck\",\n            \"notes\": \"On route\"\n        }\n        response = requests.post(dispatch_url, json=invalid_date_payload, timeout=TIMEOUT)\n        assert response.status_code == 400, f\"Invalid date format should return 400, got {response.status_code}\"\n        body = response.json()\n        assert body.get(\"success\") is False\n        assert \"error\" in body and isinstance(body[\"error\"], str)\n\n        # Dispatch submission with missing required fields (no plateNumber)\n        missing_fields_payload = {\n            \"trackingId\": offer_payload[\"trackingId\"],\n            \"eta\": \"2026-02-22T15:00:00Z\",\n            \"date\": \"2026-02-22\",\n            \"timeWindow\": \"15:00-17:00\",\n            # \"plateNumber\" omitted\n            \"vehicleColor\": \"Blue\",\n            \"vehicleType\": \"Truck\",\n            \"notes\": \"On route\"\n        }\n        response = requests.post(dispatch_url, json=missing_fields_payload, timeout=TIMEOUT)\n        assert response.status_code == 400, f\"Missing fields should return 400, got {response.status_code}\"\n        body = response.json()\n        assert body.get(\"success\") is False\n        assert \"error\" in body and isinstance(body[\"error\"], str)\n\n        # Dispatch submission with non-existent trackingId\n        not_found_payload = {\n            \"trackingId\": \"UNKNOWN_REQ_ID_9999\",\n            \"eta\": \"2026-02-22T15:00:00Z\",\n            \"date\": \"2026-02-22\",\n            \"timeWindow\": \"15:00-17:00\",\n            \"plateNumber\": \"ABC-123\",\n            \"vehicleColor\": \"Blue\",\n            \"vehicleType\": \"Truck\",\n            \"notes\": \"On route\"\n        }\n        response = requests.post(dispatch_url, json=not_found_payload, timeout=TIMEOUT)\n        assert response.status_code == 404, f\"Unknown trackingId should return 404, got {response.status_code}\"\n        body = response.json()\n        assert body.get(\"success\") is False\n        assert \"error\" in body and isinstance(body[\"error\"], str)\n\n    finally:\n        # Cleanup: delete the offer - no delete endpoint specified, so skip if none\n        # Usually, if cleanup is needed, here would be the code to delete created resources.\n        pass\n\ntest_post_submit_transport_dispatch_details()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 107, in <module>\n  File \"<string>\", line 30, in test_post_submit_transport_dispatch_details\nAssertionError: Offer acceptance failed with status 404\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-02-25T04:37:41.248Z",
    "modified": "2026-02-25T04:38:12.053Z"
  }
]
